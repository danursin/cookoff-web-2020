import{aY as Y,R as B,z as ce,_ as ve,h as w,c as R,g as q,a as z,i as U,j as s,n as ye,r as h,b as Z,u as S,W as ne,C as X,aQ as le,B as J,I as oe,f as C,F as ae,P as ue,l as De,M as Ie,p as Pe,H as Ee,S as se,J as ke,aU as be,K as ee,T as we,Q as Ne}from"./index.85b6536d.js";import{T as P,a as Q}from"./Tab.3922e4ac.js";import{B as A}from"./axios.f9722dd0.js";import{s as xe,i as Se,r as Ae,a as Me,M as ge,F as y}from"./Message.64e2fdfa.js";import{a as Te,u as ie,i as V,s as re,l as Ce,d as Oe,q as Le}from"./lodash.ec14961c.js";var Re=Y()?B.useLayoutEffect:B.useEffect;const de=Re;var Ue=/\s+/;function Fe(t){var n=[];return t?(t.forEach(function(o){if(typeof o.current=="string"){var e=o.current.split(Ue);e.forEach(function(r){n.push(r)})}}),n.filter(function(o,e,r){return o.length>0&&r.indexOf(o)===e})):[]}function $e(t,n){return[n.filter(function(o){return t.indexOf(o)===-1}),t.filter(function(o){return n.indexOf(o)===-1})]}var fe=new Map,te=function(n,o){var e=Fe(o),r=$e(fe.get(n)||[],e),a=r[0],u=r[1];n&&(a.forEach(function(c){return n.classList.add(c)}),u.forEach(function(c){return n.classList.remove(c)})),fe.set(n,e)},He=function(){var n=this;this.add=function(o,e){if(n.nodes.has(o)){var r=n.nodes.get(o);r.add(e);return}var a=new Set;a.add(e),n.nodes.set(o,a)},this.del=function(o,e){if(!!n.nodes.has(o)){var r=n.nodes.get(o);if(r.size===1){n.nodes.delete(o);return}r.delete(e)}},this.emit=function(o,e){e(o,n.nodes.get(o))},this.nodes=new Map},W=new He;function Be(t,n){var o=B.useRef(),e=B.useRef(!1);de(function(){if(o.current=n,e.current){var r=ce(t)?t.current:t;W.emit(r,te)}e.current=!0},[n]),de(function(){var r=ce(t)?t.current:t;return W.add(r,o),W.emit(r,te),function(){W.del(r,o),W.emit(r,te)}},[t])}var j=function(t){ve(n,t);function n(){for(var e,r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return e=t.call.apply(t,[this].concat(a))||this,e.handleButtonOverrides=function(c){return{onClick:function(p,l){w(c,"onClick",p,l),w(e.props,"onActionClick",p,l)}}},e}var o=n.prototype;return o.render=function(){var r=this,a=this.props,u=a.actions,c=a.children,i=a.className,p=a.content,l=R("actions",i),d=q(n,this.props),f=z(n,this.props);return U(c)?U(p)?s(f,{...d,className:l,children:ye(u,function(m){return A.create(m,{overrideProps:r.handleButtonOverrides})})}):s(f,{...d,className:l,children:p}):s(f,{...d,className:l,children:c})},n}(h.exports.Component);j.handledProps=["actions","as","children","className","content","onActionClick"];j.propTypes={};j.create=Z(j,function(t){return{actions:t}});function M(t){var n=t.children,o=t.className,e=t.content,r=t.image,a=t.scrolling,u=R(o,S(r,"image"),S(a,"scrolling"),"content"),c=q(M,t),i=z(M,t);return s(i,{...c,className:u,children:U(n)?e:n})}M.handledProps=["as","children","className","content","image","scrolling"];M.propTypes={};M.create=Z(M,function(t){return{content:t}});function _(t){var n=t.children,o=t.className,e=t.content,r=R("description",o),a=q(_,t),u=z(_,t);return s(u,{...a,className:r,children:U(n)?e:n})}_.handledProps=["as","children","className","content"];_.propTypes={};function T(t){var n=t.blurring,o=t.children,e=t.className,r=t.centered,a=t.content,u=t.inverted,c=t.mountNode,i=t.scrolling,p=B.useRef(),l=R("ui",S(u,"inverted"),S(!r,"top aligned"),"page modals dimmer transition visible active",e),d=R("dimmable dimmed",S(n,"blurring"),S(i,"scrolling")),f=q(T,t),m=z(T,t);return Be(c,d),B.useEffect(function(){p.current&&p.current.style&&p.current.style.setProperty("display","flex","important")},[]),s(ne,{innerRef:p,children:s(m,{...f,className:l,children:U(o)?a:o})})}T.handledProps=["as","blurring","centered","children","className","content","inverted","mountNode","scrolling"];T.propTypes={};T.create=Z(T,function(t){return{content:t}});function O(t){var n=t.children,o=t.className,e=t.content,r=R("header",o),a=q(O,t),u=z(O,t);return s(u,{...a,className:r,children:U(n)?e:n})}O.handledProps=["as","children","className","content"];O.propTypes={};O.create=Z(O,function(t){return{content:t}});var pe=0,je=50,qe=function(n){var o=n.height+pe,e=n.height+pe,r=window.innerHeight,a=r/2,u=-(e/2),c=je,i=a+u;return i+o+c<r},ze=function(n,o,e){var r=o&&n?-(e.height/2):0,a=-(e.width/2);return{marginLeft:a,marginTop:r}},Ge=function(){return!window.ActiveXObject&&"ActiveXObject"in window},N=function(t){ve(n,t);function n(){for(var e,r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return e=t.call.apply(t,[this].concat(a))||this,e.legacy=Y()&&Ge(),e.ref=h.exports.createRef(),e.dimmerRef=h.exports.createRef(),e.latestDocumentMouseDownEvent=null,e.getMountNode=function(){return Y()?e.props.mountNode||document.body:null},e.handleActionsOverrides=function(c){return{onActionClick:function(p,l){w(c,"onActionClick",p,l),w(e.props,"onActionClick",p,e.props),e.handleClose(p)}}},e.handleClose=function(c){e.setState({open:!1}),w(e.props,"onClose",c,X({},e.props,{open:!1}))},e.handleDocumentMouseDown=function(c){e.latestDocumentMouseDownEvent=c},e.handleDocumentClick=function(c){var i=e.props.closeOnDimmerClick,p=e.latestDocumentMouseDownEvent;e.latestDocumentMouseDownEvent=null,!(!i||le(e.ref.current,p)||le(e.ref.current,c))&&(e.setState({open:!1}),w(e.props,"onClose",c,X({},e.props,{open:!1})))},e.handleIconOverrides=function(c){return{onClick:function(p){w(c,"onClick",p),e.handleClose(p)}}},e.handleOpen=function(c){w(e.props,"onOpen",c,X({},e.props,{open:!0})),e.setState({open:!0})},e.handlePortalMount=function(c){var i=e.props.eventPool;e.setState({scrolling:!1}),e.setPositionAndClassNames(),J.sub("mousedown",e.handleDocumentMouseDown,{pool:i,target:e.dimmerRef.current}),J.sub("click",e.handleDocumentClick,{pool:i,target:e.dimmerRef.current}),w(e.props,"onMount",c,e.props)},e.handlePortalUnmount=function(c){var i=e.props.eventPool;cancelAnimationFrame(e.animationRequestId),J.unsub("mousedown",e.handleDocumentMouseDown,{pool:i,target:e.dimmerRef.current}),J.unsub("click",e.handleDocumentClick,{pool:i,target:e.dimmerRef.current}),w(e.props,"onUnmount",c,e.props)},e.setPositionAndClassNames=function(){var c=e.props.centered,i,p={};if(e.ref.current){var l=e.ref.current.getBoundingClientRect(),d=qe(l);i=!d;var f=e.legacy?ze(d,c,l):{};xe(e.state.legacyStyles,f)||(p.legacyStyles=f),e.state.scrolling!==i&&(p.scrolling=i)}Se(p)||e.setState(p),e.animationRequestId=requestAnimationFrame(e.setPositionAndClassNames)},e.renderContent=function(c){var i=e.props,p=i.actions,l=i.basic,d=i.children,f=i.className,m=i.closeIcon,g=i.content,D=i.header,I=i.size,G=i.style,L=e.state,F=L.legacyStyles,v=L.scrolling,E=R("ui",I,S(l,"basic"),S(e.legacy,"legacy"),S(v,"scrolling"),"modal transition visible active",f),$=z(n,e.props),x=m===!0?"close":m,k=oe.create(x,{overrideProps:e.handleIconOverrides});return s(ne,{innerRef:e.ref,children:C($,{...c,className:E,style:X({},F,G),children:[k,U(d)?C(ae,{children:[O.create(D,{autoGenerateKey:!1}),M.create(g,{autoGenerateKey:!1}),j.create(p,{overrideProps:e.handleActionsOverrides})]}):d]})})},e}var o=n.prototype;return o.componentWillUnmount=function(){this.handlePortalUnmount()},o.render=function(){var r=this.props,a=r.centered,u=r.closeOnDocumentClick,c=r.dimmer,i=r.eventPool,p=r.trigger,l=this.state,d=l.open,f=l.scrolling,m=this.getMountNode();if(!Y())return h.exports.isValidElement(p)?p:null;var g=q(n,this.props),D=ue.handledProps,I=Ae(g,function(L,F,v){return Pe(D,v)||(L[v]=F),L},{}),G=Me(g,D);return s(ue,{closeOnDocumentClick:u,...G,trigger:p,eventPool:i,mountNode:m,open:d,onClose:this.handleClose,onMount:this.handlePortalMount,onOpen:this.handleOpen,onUnmount:this.handlePortalUnmount,children:s(ne,{innerRef:this.dimmerRef,children:T.create(De(c)?c:{},{autoGenerateKey:!1,defaultProps:{blurring:c==="blurring",inverted:c==="inverted"},overrideProps:{children:this.renderContent(I),centered:a,mountNode:m,scrolling:f}})})})},n}(Ie);N.handledProps=["actions","as","basic","centered","children","className","closeIcon","closeOnDimmerClick","closeOnDocumentClick","content","defaultOpen","dimmer","eventPool","header","mountNode","onActionClick","onClose","onMount","onOpen","onUnmount","open","size","style","trigger"];N.propTypes={};N.defaultProps={centered:!0,dimmer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!1,eventPool:"Modal"};N.autoControlledProps=["open"];N.Actions=j;N.Content=M;N.Description=_;N.Dimmer=T;N.Header=O;const H=N,K=h.exports.createContext({setCookoff:()=>{throw new Error("not implemented")},setEntries:()=>{throw new Error("not implemented")},setParticipants:()=>{throw new Error("not implemented")}}),We=t=>{const{onClose:n,entry:o,open:e,onSaveComplete:r}=t,[a,u]=h.exports.useState({...o}),[c,i]=h.exports.useState(!1),[p,l]=h.exports.useState(),[d,f]=h.exports.useState(),{participants:m}=h.exports.useContext(K);let g=null;h.exports.useEffect(()=>{u({...o}),l(void 0)},[o]);const D=v=>{const x=v.naturalWidth/v.width,k=v.naturalHeight/v.height,b=document.createElement("canvas");return b.width=680,b.height=512,b.getContext("2d").drawImage(v,0,0,v.width*x,v.height*k,0,0,680,512),b.toDataURL("image/png")},I=async v=>{const E=v.currentTarget.files;if(!E||!E.length){f(void 0);return}const $=E[0],x=await new Promise(k=>{const b=new FileReader;b.addEventListener("load",()=>{k(b.result)},!1),b.readAsDataURL($)});f(x)},G=async v=>{v.preventDefault(),i(!0);const{Title:E,CookoffParticipantID:$}=a,x={Title:E||null,CookoffParticipantID:$,Filename:""};if(g){const k=D(g),b=await Te(k);x.Filename=b,a.Filename=b}try{if(a.CookoffEntryID)await ie({table:"CookoffEntry",values:x,where:{CookoffEntryID:a.CookoffEntryID}});else{const{CookoffEntryID:k}=await V({table:"CookoffEntry",values:x});a.CookoffEntryID=k}r(a)}catch(k){l(k.message),console.log(k)}finally{i(!1)}};if(!m)throw new Error("Participants missing when it shouldn't be");const L=m.filter(v=>v.IsParticipant).map(v=>({key:v.CookoffParticipantID,value:v.CookoffParticipantID,text:`${v.Name} (${v.Username})`})),F=a.Filename?`${Ee.cookoffApiUrl}/file?key=${a.Filename}`:null;return C(H,{onClose:n,closeIcon:!0,size:"small",open:e,children:[s(H.Header,{content:a.CookoffEntryID?"Edit Entry":"Add Entry"}),C(H.Content,{scrolling:!0,children:[!!p&&s(ge,{error:!0,icon:"exclamation triangle",content:p}),C(y,{onSubmit:G,loading:c,children:[s(y.Input,{placeholder:"Entry Title",fluid:!0,label:"Entry Title",maxLength:"100",value:a.Title,onChange:(v,{value:E})=>u({...a,Title:E})}),s(y.Dropdown,{label:"Entrant",placeholder:"Entrant",selection:!0,required:!0,options:L,value:a.CookoffParticipantID,onChange:(v,{value:E})=>u({...a,CookoffParticipantID:E})}),s(y.Input,{placeholder:"Entry Image",fluid:!0,maxLength:"1",type:"file",label:"Entry Image",onChange:I}),(!!d||!!F)&&s("img",{alt:"entry",src:d||F||"",style:{margin:"2rem auto",display:"block",width:"100%"},ref:v=>g=v}),s(y.Button,{fluid:!0,color:"blue",content:"Save",icon:"save",type:"submit"})]})]})]})},me={Title:""},_e=()=>{const{cookoff:t,participants:n,setParticipants:o,entries:e,setEntries:r}=h.exports.useContext(K),[a,u]=h.exports.useState(me),[c,i]=h.exports.useState(!1);return h.exports.useEffect(()=>{e||(async()=>{const l=[re({objectName:"GetCookoffEntries",parameters:{CookoffID:t==null?void 0:t.CookoffID}}),n?void 0:re({objectName:"GetCookoffParticipants",parameters:{CookoffID:t==null?void 0:t.CookoffID}})],[d,f]=await Promise.all(l);r(d),f&&o(f)})()},[t,e,r,n,o]),!n||!e?s(se,{}):C(ae,{children:[s(A,{color:"blue",fluid:!0,icon:"plus circle",content:"Add Entry",onClick:()=>{u({...me}),i(!0)}}),s(We,{open:c,onClose:()=>i(!1),entry:a,onSaveComplete:l=>{const d=e.find(f=>f.CookoffEntryID===l.CookoffEntryID);d?Object.assign(d,l):e.push(l),r(Ce.exports.sortBy(e,"Title")),i(!1)}}),s(P,{compact:"very",unstackable:!0,children:C(P.Body,{children:[!e.length&&s(P.Row,{children:s(P.Cell,{colSpan:3,content:"No entries registered yet...",warning:!0})}),e.map(l=>{const{CookoffEntryID:d,Title:f,CookoffParticipantID:m}=l,{Name:g,Username:D}=n.find(I=>I.CookoffParticipantID===m);return C(P.Row,{children:[s(P.Cell,{children:s(A,{icon:"pencil",color:"blue",basic:!0,size:"small",onClick:()=>{u(l),i(!0)}})}),s(P.Cell,{children:s(ke,{color:"grey",content:f,subheader:`${g} (${D})`})}),s(P.Cell,{textAlign:"right",children:s(A,{color:"red",basic:!0,icon:"trash",size:"small",onClick:()=>{window.confirm("Are you sure?")}})})]},d)})]})})]})},Ke=()=>{const{cookoff:t,setCookoff:n}=h.exports.useContext(K),[o,e]=h.exports.useState(!1),r=be();if(!t)throw new Error("Cookoff undefined in page dedicated to cookoff");const a=()=>{t.CookoffID?r(`/cookoff/${t.CookoffID}`):r("/dashboard")};return C(y,{onSubmit:async()=>{e(!0);const{Title:c,EventStartDate:i,EventEndDate:p,AreScoresReleased:l}=t;if(t.CookoffID)await ie({table:"Cookoff",values:{Title:c,EventStartDate:i,EventEndDate:p,AreScoresReleased:l},where:{CookoffID:t.CookoffID}});else{const{CookoffID:d}=await V({table:"Cookoff",values:{HostParticipantID:t.HostParticipantID,Title:c,EventStartDate:i,EventEndDate:p,AreScoresReleased:l}});n({...t,CookoffID:d})}e(!1)},loading:o,children:[s(y.Input,{label:"Cookoff Title",required:!0,placeholder:"Cookoff Title",value:t.Title,onChange:(c,i)=>n({...t,Title:i.value})}),C(y.Group,{children:[s(y.Input,{width:"8",required:!0,label:"Event Start Date",placeholder:"Event Start Date",type:"datetime-local",value:t.EventStartDate,onChange:(c,{value:i})=>n({...t,EventStartDate:`${i}:00`})}),s(y.Input,{width:"8",required:!0,label:"Event End Date",type:"datetime-local",placeholder:"Event End Date",value:t.EventEndDate,onChange:(c,{value:i})=>{n({...t,EventEndDate:`${i}:00`})}})]}),s(y.Checkbox,{style:{marginTop:"1rem"},label:"Are Scores Released?",toggle:!0,checked:t.AreScoresReleased,onChange:(c,i)=>n({...t,AreScoresReleased:!!i.checked})}),C(ee,{columns:"equal",children:[s(ee.Column,{children:s(A,{content:"Go Back",type:"button",icon:"arrow left",color:"grey",fluid:!0,onClick:a})}),s(ee.Column,{children:s(A,{content:"Save",type:"submit",icon:"save",color:"blue",fluid:!0})})]})]})},Xe=t=>{const{onClose:n,participant:o,open:e,onSaveComplete:r}=t,[a,u]=h.exports.useState({...o}),[c,i]=h.exports.useState(!1),[p,l]=h.exports.useState();h.exports.useEffect(()=>{u({...o}),l(void 0)},[o]);const d=async f=>{f.preventDefault(),i(!0);const{Name:m,Username:g,IsAdmin:D}=a;try{if(a.ParticipantID)await ie({table:"Participant",values:{Name:m||null,Username:g||null,IsAdmin:!!D},where:{ParticipantID:a.ParticipantID}});else{const{ParticipantID:I}=await V({table:"Participant",values:{Name:m||null,Username:g||null,IsAdmin:!!D}});a.ParticipantID=I}r(a)}catch(I){l(I.message),console.log(I)}finally{i(!1)}};return C(H,{onClose:n,closeIcon:!0,size:"small",open:e,children:[s(H.Header,{content:a.ParticipantID?"Edit Participant":"Add Participant"}),C(H.Content,{scrolling:!0,children:[!!p&&s(ge,{error:!0,icon:"exclamation triangle",content:p}),C(y,{onSubmit:d,loading:c,children:[s(y.Input,{placeholder:"Participant Name",fluid:!0,label:"Participant Name",value:a.Name,onChange:(f,{value:m})=>u({...a,Name:m})}),s(y.Input,{placeholder:"Username",fluid:!0,label:"Username",value:a.Username,onChange:(f,{value:m})=>u({...a,Username:m})}),s(y.Checkbox,{toggle:!0,label:"Is Administrator?",checked:a.IsAdmin,onChange:(f,{checked:m})=>u({...a,IsAdmin:!!m})}),s(y.Button,{fluid:!0,color:"blue",content:"Save",icon:"save",type:"submit"})]})]})]})},he={Name:"",Username:"",IsAdmin:!1},Je=()=>{const{cookoff:t,participants:n,setParticipants:o}=h.exports.useContext(K),[e,r]=h.exports.useState(!1),[a,u]=h.exports.useState(he);if(h.exports.useEffect(()=>{n||(async()=>{const l=await re({objectName:"GetCookoffParticipants",parameters:{CookoffID:t==null?void 0:t.CookoffID}});o(l)})()},[t,n,o]),!n)return s(se,{message:"Loading participants"});const c=async l=>{o(n.map(f=>(f.ParticipantID===l&&(f.IsLoading=!0),f)));const{CookoffParticipantID:d}=await V({table:"CookoffParticipant",values:{CookoffID:t==null?void 0:t.CookoffID,ParticipantID:l}});o(n.map(f=>(f.ParticipantID===l&&(f.IsParticipant=!0,f.CookoffParticipantID=d,f.IsLoading=!1),f)))},i=async l=>{!window.confirm("Are you sure?")||(o(n.map(d=>(d.ParticipantID===l&&(d.IsLoading=!0),d))),await Oe({table:"CookoffParticipant",where:{CookoffID:t==null?void 0:t.CookoffID,ParticipantID:l}}),o(n.map(d=>(d.ParticipantID===l&&(d.IsParticipant=!1,d.IsLoading=!1),d))))};return C(ae,{children:[s(A,{color:"blue",content:"Add Participant",icon:"plus circle",fluid:!0,onClick:()=>{u(he),r(!0)}}),s(Xe,{open:e,onClose:()=>r(!1),participant:a,onSaveComplete:l=>{const d=n.find(f=>f.ParticipantID===l.ParticipantID);if(d)Object.assign(d,l);else{const f={...l,IsParticipant:!1,ParticipantID:l.ParticipantID};n.push(f)}o(Ce.exports.sortBy(n,"Name")),r(!1)}}),s(P,{compact:"very",unstackable:!0,children:s(P.Body,{children:n.map(l=>{const{Name:d,Username:f,ParticipantID:m,IsParticipant:g,IsLoading:D,IsAdmin:I}=l;return C(P.Row,{children:[s(P.Cell,{children:s(A,{icon:"pencil",color:"blue",basic:!0,size:"small",onClick:()=>{u(l),r(!0)}})}),C(P.Cell,{children:[`${d} (${f})`," ",I&&s(oe,{name:"cog",color:"grey",title:"This user is an administrator"})]}),s(P.Cell,{textAlign:"right",children:s(A,{icon:s(oe,{name:D?"cog":g?"minus circle":"plus circle",loading:D}),color:g?"red":"green",basic:!0,size:"small",onClick:()=>g?i(m):c(m)})})]},m)})})})]})},ot=()=>{const{id:t}=we(),n=+t,[o,e]=h.exports.useState(!0),{user:r}=h.exports.useContext(Ne),a={Title:"",EventStartDate:"",EventEndDate:"",HostParticipantID:r==null?void 0:r.ParticipantID,AreScoresReleased:!1},[u,c]=h.exports.useState(a),[i,p]=h.exports.useState(),[l,d]=h.exports.useState();if(h.exports.useEffect(()=>{if(!n){e(!1);return}(async()=>{const[m]=await Le({table:"Cookoff",where:{CookoffID:n}});m.EventStartDate=m.EventStartDate.replace("Z",""),m.EventEndDate=m.EventEndDate.replace("Z",""),c(m),e(!1)})()},[n,e,c]),o)return s(se,{message:"Loading cookoff data..."});const f=[{menuItem:"Cookoff",render:()=>s(Q.Pane,{children:s(Ke,{})})},{menuItem:{content:"Participants",color:"grey",key:"participants",disabled:!u||!u.CookoffID},render:()=>s(Q.Pane,{children:s(Je,{})})},{menuItem:{content:"Entries",color:"grey",key:"entries",disabled:!u||!u.CookoffID},disabled:!u||!u.CookoffID,render:()=>s(Q.Pane,{children:s(_e,{})})}];return s(K.Provider,{value:{cookoff:u,setCookoff:c,participants:i,setParticipants:p,entries:l,setEntries:d},children:s(Q,{panes:f,menu:{secondary:!0,pointing:!0}})})};export{ot as default};
